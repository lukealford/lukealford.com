(function(g){var e=[];var b=[];var a=[];var i=[];g(document).on("click",".vp-wpa-group-title",function(n){n.preventDefault();var m=g(this).parents(".wpa_group:first");var l=m.find(".vp-controls:first");var o=m.siblings(".wpa_group:not(.tocopy)");var k=g("html, body");if(l.hasClass("vp-hide")){if(o.exists()){o.each(function(p,q){g(this).find(".vp-controls").first().slideUp("fast",function(){g(this).addClass("vp-hide").slideDown(0,function(){if(p==o.length-1){k.animate({scrollTop:m.offset().top-k.offset().top+k.scrollTop()-g("#wpadminbar").height()}).promise().done(function(){l.slideUp(0,function(){g(this).removeClass("vp-hide").slideDown("fast")})})}})})})}else{k.animate({scrollTop:m.offset().top-k.offset().top+k.scrollTop()-g("#wpadminbar").height()}).promise().done(function(){l.slideUp(0,function(){g(this).removeClass("vp-hide").slideDown("fast")})})}}else{l.slideUp("fast",function(){g(this).addClass("vp-hide").slideDown(0)})}return false});function c(k){k.each(function(){if(g(this).parents(".tocopy").length<=0){vp.init_controls(g(this));var r=g(this).attr("id"),l=g(this).attr("id"),p=g(this).attr("data-vp-validation"),q=g(this).attr("data-vp-bind"),n=g(this).attr("data-vp-items-bind"),o=g(this).attr("data-vp-dependency"),m=g(this).getDatas().type;p&&e.push({name:r,rules:p,type:m});if(typeof q!=="undefined"&&q!==false){q&&b.push({bind:q,type:m,source:r})}if(typeof n!=="undefined"&&n!==false){n&&a.push({bind:n,type:m,source:r})}if(typeof o!=="undefined"&&o!==false){o&&i.push({dep:o,type:"field",source:r})}}})}function j(k){k.each(function(){if(g(this).parents(".tocopy").length<=0&&!g(this).hasClass(".tocopy")){var m=g(this).attr("data-vp-dependency"),l=g(this).getDatas().type,n=g(this).attr("id");if(typeof m!=="undefined"&&m!==false){m&&i.push({dep:m,type:"section",source:n})}}})}g(document).ready(function(){c(jQuery(".vp-metabox .vp-field"));j(jQuery(".vp-metabox .vp-meta-group"));d(b);f(a);h(i);if(typeof window.KIA_metabox!=="undefined"){KIA_metabox.sortable()}});vp.is_multianswer=function(k){var l=["vp-checkbox","vp-checkimage","vp-multiselect"];if(jQuery.inArray(k,l)!==-1){return true}return false};vp.custom_check_radio_event(".vp-metabox",".vp-field.vp-checkimage .field .input label");vp.custom_check_radio_event(".vp-metabox",".vp-field.vp-radioimage .field .input label");g("#post").on("submit",function(n){var m=g("input[type=submit][clicked=true]"),l=m.val(),o=0;vp.tinyMCE_save();g(".vp-field").removeClass("vp-error");g(".validation-msg.vp-error").remove();g(".vp-metabox-error").remove();o=vp.fields_validation_loop(e);if(o>0){$notif=g('<span class="vp-metabox-error vp-js-tipsy" original-title="'+o+' error(s) found in metabox"></span>');if(l==="Save Draft"){g("#minor-publishing-actions .spinner, #minor-publishing-actions .ajax-loading").hide();$notif.tipsy();$notif.insertAfter("#minor-publishing-actions .spinner, #minor-publishing-actions .ajax-loading");g("#save-post").prop("disabled",false).removeClass("button-disabled")}else{if(l==="Publish"||l==="Update"){g("#publishing-action .spinner, #publishing-action .ajax-loading").hide();$notif.tipsy();$notif.insertAfter("#publishing-action .spinner, #publishing-action .ajax-loading");g("#publish").prop("disabled",false).removeClass("button-primary-disabled")}}var k=Math.ceil((m.outerHeight()-$notif.height())/2);if(k>0){$notif.css("margin-top",k)}n.preventDefault();return}g(this).find(".vp-toggle .vp-input").each(function(){var p=g("<input>",{type:"hidden",name:this.name,value:0});g(this).before(p)})});g("#post input[type=submit]").click(function(){g("input[type=submit]",g(this).parents("form")).removeAttr("clicked");g(this).attr("clicked","true")});function d(l){for(var o=0;o<l.length;o++){var q=l[o];var s=q.bind.split("|");var m=s[0];var r=s[1];var k=[];var p="";p=q.source.replace("[]","");p=p.substring(0,p.lastIndexOf("["));r=r.split(/[\s,]+/);for(var n=0;n<r.length;n++){r[n]=p+"["+r[n]+"]";k.push(r[n])}for(n=0;n<k.length;n++){vp.binding_event(k,n,q,m,".vp-metabox","metabox")}}}function f(k){for(var o=0;o<k.length;o++){var q=k[o];var s=q.bind.split("|");var m=s[0];var r=s[1];var l=[];var p="";p=q.source.replace("[]","");p=p.substring(0,p.lastIndexOf("["));r=r.split(/[\s,]+/);for(var n=0;n<r.length;n++){r[n]=p+"["+r[n]+"]";l.push(r[n])}for(n=0;n<l.length;n++){vp.items_binding_event(l,n,q,m,".vp-metabox","metabox")}}}function h(q){for(var n=0;n<q.length;n++){var r=q[n];var t=r.dep.split("|");var l=t[0];var s=t[1];var k=[];var o="";if(r.type==="field"){o=r.source.replace("[]","");o=o.substring(0,o.lastIndexOf("["))}else{if(r.type==="section"){var p=jQuery(vp.jqid(r.source));if(p.parents(".wpa_group").length>0){o=jQuery(vp.jqid(r.source)).parents(".wpa_group").first().attr("id")}else{o=jQuery(vp.jqid(r.source)).parents(".postbox").attr("id");o=o.substring(0,o.lastIndexOf("_"))}}}s=s.split(",");for(var m=0;m<s.length;m++){s[m]=o+"["+s[m]+"]";k.push(s[m])}for(m=0;m<k.length;m++){vp.dependency_event(k,m,r,l,".vp-metabox")}}}g.wpalchemy.on("wpa_copy",function(k,l){b=[];i=[];a=[];l.find('input[class="tocopy-hidden"]').first().remove();c(l.find(".vp-field"));j(l.find(".vp-meta-group"));l.find(".vp-wpa-group-title:first").click();d(b);f(a);h(i)})}(jQuery));